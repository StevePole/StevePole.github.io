<!DOCTYPE html>
<html lang="en" ng-app="apis-application">
  <head>
    <meta charset="utf-8">
    <title>Angular SDK - Alchemy Developer Centre</title>
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
	<script src="components/jquery/dist/jquery.min.js" type="text/javascript"></script>
    <script src="components/underscore/underscore-min.js" type="text/javascript"></script>
    
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.13/angular.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.13/angular-route.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.13/angular-sanitize.js"></script>
    
    <script src="../js/app.js" type="text/javascript"></script>
    <script src="../js/utils.js" type="text/javascript"></script>
    
    <script src="js/controllers.min.js" type="text/javascript"></script>
    <script src="js/services.min.js" type="text/javascript"></script>
    <script src="js/directives.min.js" type="text/javascript"></script>
    <script src="js/filters.min.js" type="text/javascript"></script>
    
    <style>
    #sdk-template {
        display: none;
    }
    </style>
</head>
<body>
    
<pre ng-controller="SdkCtrl" ng-cloak>{{sdk}}</pre>
    
    <script id="sdk-template" type="text/x-tmpl">
<%
var firstResource = _.keys(resources)[0];
%>/**
 * DO NOT EDIT THIS FILE, this file was automatically generated, any edits 
 * will be overwritten when the file is regenerated.
 * 
 * This is an SDK containing AngularJS factories for accessing the restful web 
 * service at <%=basePath %> - The SDK was generated for 
 * version <%=apiVersion %> of the API.
 * 
 * To use the services within your AngularJS application, import into your 
 * application and controllers as follows:
 * 
 *   angular.module('YourApp', ['sdkService'])
 *   .controller('YourController', ['$scope', '<%=firstResource.capitalise() %>',
 *       function($scope, <%=firstResource.capitalise() %>) {
 *           $scope.<%=firstResource %> = <%=firstResource.capitalise() %>.get({id: 1 });
 *       }
 *   ]);
 *
 * To create an object use the following pattern. Note, when calling functions 
 * directly on resource instances the functions are prefixed with '$', so 
 * 'create' becomes '$create':
 * 
 *  var <%=firstResource %> = new <%=firstResource.capitalise() %>();
 *  <%=firstResource %>.example = "example";
 *  <%=firstResource %>.$create(function(response) { }, function(error) { });
 *  
 * The object returned from a get() is a resource itself, so you can update it 
 * directly and issue an update. By nesting the second request in the response
 * handler we have full access to the object returned from the first call.
 *  
 *  <%=firstResource.capitalise() %>.get({id: 1}, function(<%=firstResource %>) {
 *      <%=firstResource %>.example = "example";
 *      <%=firstResource %>.$update(function(response) { }, function(error) { });
 *  });
 * 
 * Angular even returns resources for array responses so you can do the 
 * following:
 * 
 *  <%=firstResource.capitalise() %>.getList({}, function(<%=firstResource %>) {
 *      var object = <%=firstResource %>[0];
 *      object.example = "example";
 *      object.$update(function(response) { }, function(error) { });
 *  });
 *  
 * If for some reason the object you are dealing with is not a resource, you can
 * use an alternative formulation to issue an update:
 * 
 *  <%=firstResource.capitalise() %>.update(
 *      {id: object.id}, object, function(response) { }, function(error) { }
 *  );
 */
var sdkService = angular.module('sdkService', ['ngResource']);

/**
 * @name sdkService.envelopeHandler
 * Handler for methods returning a response envelope, if an error is detected
 * it will be thrown, otherwise the nested response will be returned.
 * 
 * If you prefer to access the full response, override this function.
 * 
 * @param {string} data The raw response data
 * @param {object} header An object containing any response headers
 * @returns {object} Either an Error object or the response
 */
sdkService.envelopeHandler = function(json, headers) {
    if (json) {
        if (json.error) {
            throw new Error(json.error.message);
        }
        return json.<%=envelope.mainParam %>;
    }
    return {};
};
<% _.each(resources, function(resource, resourceName) {
    var idApi = resource.idApi;
    var listApi = resource.listApi;
    var childApis = resource.childApis;
    var parentApis = resource.parentApis;
    var actionApis = resource.actionApis;
    %>
/**
 * Factory for interacting with <%=resourceName.capitalise() %> objects and their
 * related descendents.
 */
sdkService.factory('<%=resourceName.capitalise() %>', ['$resource', function($resource) {
    return $resource(':_parent/:id/:_child', {_parent: '<%=resourceName %>'}, {<%
    if (resource.listOperations && resource.listOperations.POST) { %>
        create: {
            method: 'POST',
            responseType: 'json'<%
            if (listApi.operations.POST.usesEnvelope) { %>,
            transformResponse: sdkService.envelopeHandler<%
            }
            if (listApi.operations.POST.isArray) { %>,
            isArray: true<%
            } %>
        },<%
    }
    if (resource.idOperations && resource.idOperations.GET) { %>
        get: {
            method: 'GET',
            responseType: 'json',
            params: {id: '@<%=idApi.parentModelIdProperty %>'}<%
            if (idApi.operations.GET.usesEnvelope) { %>,
            transformResponse: sdkService.envelopeHandler<%
            }
            if (idApi.operations.GET.isArray) { %>,
            isArray: true<%
            } %>
        },<%
    }
    if (resource.idOperations && resource.idOperations.PUT) { %>
        update: {
            method: 'PUT',
            responseType: 'json',
            params: {id: '@<%=idApi.parentModelIdProperty %>'}<%
            if (idApi.operations.PUT.usesEnvelope) { %>,
            transformResponse: sdkService.envelopeHandler<%
            }
            if (idApi.operations.PUT.isArray) { %>,
            isArray: true<%
            } %>
        },<%
    }
    if (resource.idOperations && resource.idOperations.DELETE) { %>
        delete: {
            method: 'DELETE',
            responseType: 'json',
            params: {id: '@<%=idApi.parentModelIdProperty %>'}<%
            if (idApi.operations.DELETE.usesEnvelope) { %>,
            transformResponse: sdkService.envelopeHandler<%
            }
            if (idApi.operations.DELETE.isArray) { %>,
            isArray: true<%
            } %>
        },<%
    }
    if (resource.listOperations && resource.listOperations.GET) { %>
        getList: {
            method: 'GET',
            responseType: 'json'<%
            if (listApi.operations.GET.usesEnvelope) { %>,
            transformResponse: sdkService.envelopeHandler<%
            }
            if (listApi.operations.GET.isArray) { %>,
            isArray: true<%
            } %>
        }, <%
    }
    if (resource.listOperations && resource.listOperations.DELETE) { %>
        deleteList: {
            method: 'DELETE',
            responseType: 'json'<%
            if (listApi.operations.DELETE.usesEnvelope) { %>,
            transformResponse: sdkService.envelopeHandler<%
            }
            if (listApi.operations.DELETE.isArray) { %>,
            isArray: true<%
            } %>
        },<%
    }
    /*
    _.each(resource.children, function(childMethods, childName) {
        if (childMethods.GET) { %>
        get<%=childName.capitalise() %>: {
            method: 'GET',
            responseType: 'json',
            params: {id: 'REQUIRED', _child: '<%=childName %>'},
            transformResponse: sdkService.envelopeHandler<%
            if (childApis[childName].operations.GET.isArray) { %>,
            isArray: true<%
            } %>
        },<%
        }
        if (childMethods.DELETE) { %>
        delete<%=childName.capitalise() %>: {
            method: 'DELETE',
            responseType: 'json',
            params: {id: 'REQUIRED', _child: '<%=childName %>'},
            transformResponse: sdkService.envelopeHandler<%
            if (childApis[childName].operations.DELETE.isArray) { %>,
            isArray: true<%
            } %>
        },<%
        }
    });
    */
    _.each(resource.actions, function(methods, action) {
        if (methods.GET) { %>
        <%=action %>: {
            method: 'GET',
            responseType: 'json',
            params: {_child: '<%=action %>'}<%
            if (actionApis[action].operations.GET.usesEnvelope) { %>,
            transformResponse: sdkService.envelopeHandler<%
            }
            if (actionApis[action].operations.GET.isArray) { %>,
            isArray: true<%
            } %>
        },<%
        }
    });
    _.each(resource.parents, function(parentMethods, parentName) {
        if (parentMethods.GET) { %>
        getBy<%=parentName.capitalise() %>Id: {
            method: 'GET',
            responseType: 'json',
            params: {id: 'REQUIRED', _parent: '<%=parentName %>', _child: '<%=resourceName %>'}<%
            if (parentApis[parentName].operations.GET.usesEnvelope) { %>,
            transformResponse: sdkService.envelopeHandler<%
            }
            if (parentApis[parentName].operations.GET.isArray) { %>,
            isArray: true<%
            } %>
        },<%
        }
        if (parentMethods.DELETE) { %>
        deleteBy<%=parentName.capitalise() %>Id: {
            method: 'DELETE',
            responseType: 'json',
            params: {id: 'REQUIRED', _parent: '<%=parentName %>', _child: '<%=resourceName %>'}<%
            if (parentApis[parentName].operations.DELETE.usesEnvelope) { %>,
            transformResponse: sdkService.envelopeHandler<%
            }
            if (parentApis[parentName].operations.DELETE.isArray) { %>,
            isArray: true<%
            } %>
        },<%
        }
    });%>
    });
}]);
<%
}); %>
    </script>
</body>
</html>
